"use strict";(self.webpackChunkcocos_docs_docusaurus=self.webpackChunkcocos_docs_docusaurus||[]).push([[965],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(67294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=d(n),u=s,g=p["".concat(l,".").concat(u)]||p[u]||m[u]||o;return n?a.createElement(g,r(r({ref:t},c),{},{components:n})):a.createElement(g,r({ref:t},c))}));function g(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=n.length,r=new Array(o);r[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:s,r[1]=i;for(var d=2;d<o;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4848:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var a=n(87462),s=(n(67294),n(3905));const o={},r="Message System",i={unversionedId:"editor/extension/messages",id:"editor/extension/messages",title:"Message System",description:'There are many independent processes running in Cocos Creator, and they are isolated from each other. When you need to interact with other functions within the editor, you need to do so through the "messaging mechanism".',source:"@site/docs/editor/extension/messages.md",sourceDirName:"editor/extension",slug:"/editor/extension/messages",permalink:"/pt/docs/editor/extension/messages",draft:!1,editUrl:"https://github.com/cocos/cocos-docs/docs/editor/extension/messages.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Install and Share",permalink:"/pt/docs/editor/extension/install"},next:{title:"Extension Infrastructure",permalink:"/pt/docs/editor/extension/package"}},l={},d=[{value:"Message Types",id:"message-types",level:2},{value:"Normal messages",id:"normal-messages",level:3},{value:"Naming Convention for Normal Messages",id:"naming-convention-for-normal-messages",level:4},{value:"Broadcast Messages",id:"broadcast-messages",level:3},{value:"Receive Broadcast Messages",id:"receive-broadcast-messages",level:4},{value:"Sending Broadcast Messages",id:"sending-broadcast-messages",level:4},{value:"Naming Convention for Broadcast Messages",id:"naming-convention-for-broadcast-messages",level:4},{value:"View the List of Messages",id:"view-the-list-of-messages",level:2},{value:"Sending Messages in Code",id:"sending-messages-in-code",level:2}],c={toc:d},p="wrapper";function m(e){let{components:t,...n}=e;return(0,s.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"message-system"},"Message System"),(0,s.kt)("p",null,'There are many independent processes running in Cocos Creator, and they are isolated from each other. When you need to interact with other functions within the editor, you need to do so through the "messaging mechanism".'),(0,s.kt)("p",null,'The "Message System" in the editor is a functional extension of the IPC (Inter-Process Communication) wrapper. This system carries the burden of communication and interaction within the editor.'),(0,s.kt)("p",null,"For more information about multi-process architecture and cross-process communication, please refer to the document ",(0,s.kt)("a",{parentName:"p",href:"/pt/docs/editor/extension/package"},"Extension Infrastructure"),"."),(0,s.kt)("h2",{id:"message-types"},"Message Types"),(0,s.kt)("p",null,"There are two types of messages within the Cocos Creator system."),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Normal message: a message is sent to a function (extension) on its own initiative"),(0,s.kt)("li",{parentName:"ol"},"Broadcast messages: a function (extension) sends a notification to everyone that an operation has been completed")),(0,s.kt)("h3",{id:"normal-messages"},"Normal messages"),(0,s.kt)("p",null,"It can be understood as an external interface, for example the engine's ",(0,s.kt)("strong",{parentName:"p"},"Scene Editor")," module has defined a ",(0,s.kt)("inlineCode",{parentName:"p"},"query-node")," message for querying nodes, as follows:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "scene",\n    "contributions": {\n        "messages": {\n            "query-node": {\n                "methods": ["queryNode"]\n            }\n        }\n    }\n}\n')),(0,s.kt)("p",null,"For more information on how to customize messages and the meaning of the message fields, please refer to the document ",(0,s.kt)("a",{parentName:"p",href:"/pt/docs/editor/extension/contributions-messages"},"Customized Messages"),"."),(0,s.kt)("p",null,"When we want to query a scene node in an extension we have written, we can use this message to do so, as follows:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const info = await Editor.Message.request('scene', 'query-node', uuid);\n")),(0,s.kt)("p",null,"This message is similar to a remote process call (RPC), where the ",(0,s.kt)("inlineCode",{parentName:"p"},"info")," object is part of the data on the actual node being queried."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"Note"),": Since this is a remote call, ",(0,s.kt)("inlineCode",{parentName:"p"},"request")," will not return immediately, so you need to use ",(0,s.kt)("inlineCode",{parentName:"p"},"await")," to convert asynchronous to synchronous.")),(0,s.kt)("h4",{id:"naming-convention-for-normal-messages"},"Naming Convention for Normal Messages"),(0,s.kt)("p",null,"Please use ",(0,s.kt)("strong",{parentName:"p"},"lowercase")," words, and no special characters, with ",(0,s.kt)("strong",{parentName:"p"},"-")," concatenated between words. For example, ",(0,s.kt)("inlineCode",{parentName:"p"},"open-panel"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"text-changed"),"."),(0,s.kt)("h3",{id:"broadcast-messages"},"Broadcast Messages"),(0,s.kt)("p",null,"A broadcast message is a notification to the outside world after the completion of an operation within a function."),(0,s.kt)("h4",{id:"receive-broadcast-messages"},"Receive Broadcast Messages"),(0,s.kt)("p",null,"For example, if the ",(0,s.kt)("strong",{parentName:"p"},"Scene Editor")," needs to notify everyone that a scene has been started after it has been started, the ",(0,s.kt)("strong",{parentName:"p"},"Scene Editor")," sends a broadcast message using the following code."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"Editor.Message.broadcast('scene:ready', sceneUUID);\n")),(0,s.kt)("p",null,"If an extension wants to receive ",(0,s.kt)("inlineCode",{parentName:"p"},"scene:ready")," messages, they need to be defined first in ",(0,s.kt)("inlineCode",{parentName:"p"},"package.json"),", as follows:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "hello-world",\n    "contributions": {\n        "messages": {\n            "scene:ready": {\n                "methods": ["initData"]\n            }\n        }\n    }\n}\n')),(0,s.kt)("p",null,"The broadcast ",(0,s.kt)("inlineCode",{parentName:"p"},"scene:ready")," message triggers the ",(0,s.kt)("inlineCode",{parentName:"p"},"initData"),' method in the "hello-world" extension whenever the scene is ready.'),(0,s.kt)("h4",{id:"sending-broadcast-messages"},"Sending Broadcast Messages"),(0,s.kt)("p",null,"If an extension wants to send a broadcast message, it also needs to be defined in ",(0,s.kt)("inlineCode",{parentName:"p"},"package.json")," first."),(0,s.kt)("p",null,'For example, "hello-world" will broadcast a message to other extensions when it is ready for data. As shown below:'),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "hello-world",\n    "contributions": {\n        "messages": {\n            "scene:ready": {\n                "methods": ["initData"]\n            },\n            "hello-world:ready": {\n                "public": true,\n                "description": "hello-world ready notification."\n            }\n        }\n    }\n}\n')),(0,s.kt)("p",null,'At the appropriate time, the following code is called within the "hello-world" extension to broadcast to everyone.'),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"Editor.Message.broadcast('hello-world:ready');\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"Note"),": Broadcast messages can have no ",(0,s.kt)("inlineCode",{parentName:"p"},"methods"),', which means they don\'t listen. As shown in the definition above, it means that "hello-world" does not need to listen for its own initialization completion message.')),(0,s.kt)("h4",{id:"naming-convention-for-broadcast-messages"},"Naming Convention for Broadcast Messages"),(0,s.kt)("p",null,"The format is ",(0,s.kt)("inlineCode",{parentName:"p"},"packageName:actionName"),", and the following naming is legal."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"scene:ready"),(0,s.kt)("li",{parentName:"ul"},"scene:query-node"),(0,s.kt)("li",{parentName:"ul"},"hello-world:ready"),(0,s.kt)("li",{parentName:"ul"},"hello-world:data-loaded")),(0,s.kt)("p",null,"Adding ",(0,s.kt)("inlineCode",{parentName:"p"},"packageName")," prevents naming conflicts and makes it more intuitive to see which extension is listening to which broadcast message (action) when defining messages in ",(0,s.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,s.kt)("h2",{id:"view-the-list-of-messages"},"View the List of Messages"),(0,s.kt)("p",null,"The list of messages that are available to the editor and extensions can be viewed in the ",(0,s.kt)("strong",{parentName:"p"},"Developer -> Message Manager")," panel. For detailed definition rules, please refer to the documentation ",(0,s.kt)("a",{parentName:"p",href:"/pt/docs/editor/extension/contributions-messages"},"Custom Messages"),"."),(0,s.kt)("h2",{id:"sending-messages-in-code"},"Sending Messages in Code"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"send")," method only sends the message and does not wait for a return. Use this method if you don't need to return data and don't care if execution completes."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"Editor.Message.send(pkgName, message, . .args);\n")),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"request")," method returns a promise object that receives the data returned after the message has been processed."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"await Editor.Message.request(pkgName, message, . . args);\n")),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"broadcast")," method only sends, and sends to all function extensions that listen for the corresponding message."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"Editor.Message.broadcast(`${pkgName}:${actionName}`, . .args);\n")))}m.isMDXComponent=!0}}]);
"use strict";(self.webpackChunkcocos_docs_docusaurus=self.webpackChunkcocos_docs_docusaurus||[]).push([[8757],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),p=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(i.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),h=r,m=d["".concat(i,".").concat(h)]||d[h]||u[h]||l;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=h;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[d]="string"==typeof e?e:r,o[1]=s;for(var p=2;p<l;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},20532:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const l={},o="Creating a Custom Panel",s={unversionedId:"editor/extension/panel-boot",id:"editor/extension/panel-boot",title:"Creating a Custom Panel",description:"We have already written the panel definition in package.json, it's time to implement the panel's logical functionality.",source:"@site/docs/editor/extension/panel-boot.md",sourceDirName:"editor/extension",slug:"/editor/extension/panel-boot",permalink:"/pt/docs/editor/extension/panel-boot",draft:!1,editUrl:"https://github.com/cocos/cocos-docs/docs/editor/extension/panel-boot.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Extension Infrastructure",permalink:"/pt/docs/editor/extension/package"},next:{title:"Panel and Extension Communication",permalink:"/pt/docs/editor/extension/panel-messages"}},i={},p=[{value:"template",id:"template",level:2},{value:"style",id:"style",level:2},{value:"$",id:"",level:2},{value:"methods",id:"methods",level:2},{value:"listeners",id:"listeners",level:2},{value:"ready",id:"ready",level:2},{value:"beforeClose",id:"beforeclose",level:2},{value:"close",id:"close",level:2}],c={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"creating-a-custom-panel"},"Creating a Custom Panel"),(0,r.kt)("p",null,"We have already written the panel definition in ",(0,r.kt)("a",{parentName:"p",href:"/pt/docs/editor/extension/panel"},"package.json"),", it's time to implement the panel's logical functionality."),(0,r.kt)("p",null,"It is time to identify the main entry file in the panel definition and fill it with the following content."),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"'use strict';\n\n// html text\nexports.template ='';\n// style text\nexports.style ='';\n// html selector after rendering\nexports.$ = {};\n// method on the panel\nexports.methods = {};\n// event triggered on the panel\nexports.listeners = {};\n\n// Triggered when the panel is rendered successfully\nexports.ready = async function() {};\n// Triggered when trying to close the panel\nexports.beforeClose = async function() {};\n// Triggered when the panel is actually closed\nexports.close = async function() {};\n")),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"'use strict';\n\n// html text\nexport const template = '';\n// style text\nexport const style = '';\n// html selector after rendering\nexport const $ = {};\n// method on the panel\nexport const methods = {};\n// event triggered on the panel\nexport const listeners = {};\n\n// Triggered when the panel is rendered successfully\nexport async function ready() {};\n// Triggered when trying to close the panel\nexport async function beforeClose() {};\n// Triggered when the panel is actually closed\nexport async function close() {};\n")),(0,r.kt)("p",null,"If we are using Typescript, when this is not correctly identified within functions such as ready, we can add the definition of this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"'use strict';\n\ntype Selector<$> = { $: Record<keyof $, HTMLElement | null> }\n\nexport const $ = {\n    test: '.test',\n};\n\nexport const methods = {\n    update() {},\n};\n\nexport async function ready(this: Selector<typeof $> & typeof methods) {\n    this.update();\n};\n")),(0,r.kt)("p",null,"You can also use Editor.Pabel.define for common panel objects."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"module.exprots = Editor.Panel.define({\n    methods: {\n        update() {},\n    },\n    ready() {\n        this.update();\n    },\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Editor.Panel.define")," is a new interface added in v3.3."),(0,r.kt)("h2",{id:"template"},"template"),(0,r.kt)("p",null,"html text, e.g."),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'exports.template = `\n<header>\n    Header\n</header>\n<section class="test">\n    Section\n</section>\n`;\n')),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'export const template = `\n<header>\n    Header\n</header>\n<section class="test">\n    Section\n</section>\n`;\n')),(0,r.kt)("p",null,"It is also possible to read an HTML file directly."),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const { readFileSync } = require('fs');\nconst { join } = require('path');\nexports.template = readFileSync(join(__dirname, '../static/default.html'), 'utf8');\n")),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { readFileSync } from 'fs';\nimport { join } from 'path';\nexport const template = readFileSync(join(__dirname, '../static/default.html'), 'utf8');\n")),(0,r.kt)("p",null,"When the ",(0,r.kt)("inlineCode",{parentName:"p"},"template")," is defined and the panel is opened, the content of the template will be automatically rendered to the interface."),(0,r.kt)("p",null,"In addition, the editor also provides some custom elements, which can be used in the ",(0,r.kt)("a",{parentName:"p",href:"/pt/docs/editor/extension/ui"},"UI components"),"."),(0,r.kt)("h2",{id:"style"},"style"),(0,r.kt)("p",null,"With HTML, you need to customize some styles and use style, which is a string like template."),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"exports.style = `\nheader { padding: 10px; }\n`;\n")),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"export const style = `\nheader { padding: 10px; }\n`;\n")),(0,r.kt)("p",null,"Of course, it is also possible to read a css file:"),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const { readFileSync } = require('fs');\nconst { join } = require('path');\nexports.style = readFileSync(join(__dirname, '../static/default.css'), 'utf8');\n")),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { readFileSync } from 'fs';\nimport { join } from 'path';\nexport const style = readFileSync(join(__dirname, '../static/default.css'), 'utf8');\n")),(0,r.kt)("h2",{id:""},"$"),(0,r.kt)("p",null,"This is an HTML element selector that is used as a shortcut after calling ",(0,r.kt)("inlineCode",{parentName:"p"},"querySelector")," directly to find the specified element."),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"exports.$ = {\n    header: 'header',\n    test: '.test',\n};\n")),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"export const $ = {\n    header: 'header',\n    test: '.test',\n};\n")),(0,r.kt)("p",null,"First define the selector and the editor will automatically call ",(0,r.kt)("inlineCode",{parentName:"p"},"document.querySelector")," after the template is rendered to find the corresponding element and hang it on ",(0,r.kt)("inlineCode",{parentName:"p"},"this.$"),"."),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'exports.ready = function() {\n    console.log(this.$.header); // <header>\n    console.log(this.$.test); // <section class="test">\n}\n')),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'export function ready() {\n    console.log(this.$.header); // <header>\n    console.log(this.$.test); // <section class="test">\n}\n')),(0,r.kt)("h2",{id:"methods"},"methods"),(0,r.kt)("p",null,"Methods defined on the panel. The external functions of the panel need to be encapsulated as methods and made available to the public as functions. Messages can also trigger methods on the panel directly, see ",(0,r.kt)("a",{parentName:"p",href:"/pt/docs/editor/extension/contributions-messages"},"custom messages"),"."),(0,r.kt)("p",null,"This object is full of functions, please don't mount other types of objects to it."),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const packageJSON = require('./package.json');\nexports.methods = {\n    open() {\n        Editor.Panel.open(packageJSON.name);\n    },\n};\n")),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { name } from './package.json';\nexport const methods = {\n    open() {\n        Editor.Panel.open(packageJSON.name);\n    },\n};\n")),(0,r.kt)("h2",{id:"listeners"},"listeners"),(0,r.kt)("p",null,"After the basic layout is completed, we sometimes need to update the state on some panels according to some circumstances, and this time we need to use the listeners function."),(0,r.kt)("p",null,"Javascript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"exports.listeners = {\n    /**\n     * Triggered when the panel is hidden\n     */\n    hide() {\n        console.log(`hide: ${this.hidden}`);\n    },\n    /**\n     * Triggered when the panel is displayed\n     */\n    show() {\n        console.log(`hide: ${this.hidden}`);\n    },\n    /**\n     * Triggered when the panel size is changed\n     */\n    resize() {\n        console.log(`height: ${this.clientHeight}`);\n        console.log(`width: ${this.clientWidth}`);\n    },\n};\n")),(0,r.kt)("p",null,"Typescript"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface PanelInfo {\n    hidden: boolean;\n    clientHeight: number;\n    clientWidth: number;\n}\n\nexport const listeners = {\n    /**\n     * Triggered when the panel is hidden\n     */\n    hide(this: PanelInfo) {\n        console.log(`hide: ${this.hidden}`);\n    },\n    /**\n     * Triggered when the panel is displayed\n     */\n    show(this: PanelInfo) {\n        console.log(`hide: ${this.hidden}`);\n    },\n    /**\n     * Triggered when the panel size is changed\n     */\n    resize(this: PanelInfo) {\n        console.log(`height: ${this.clientHeight}`);\n        console.log(`width: ${this.clientWidth}`);\n    },\n};\n")),(0,r.kt)("h2",{id:"ready"},"ready"),(0,r.kt)("p",null,"This life cycle function will be triggered when the panel is ready."),(0,r.kt)("h2",{id:"beforeclose"},"beforeClose"),(0,r.kt)("p",null,"This function will be triggered when the panel tries to be closed. beforeClose can be an async function, which can make asynchronous judgments, and if return false, it will terminate the current close operation."),(0,r.kt)("p",null,"Please don't execute the actual destruction and close related logic code in this function, this step is just to ask, please put the actual destruction in the close function."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Please use with caution")," If you make a mistake, the editor or panel window may not close properly."),(0,r.kt)("h2",{id:"close"},"close"),(0,r.kt)("p",null,"When all panels in the window are allowed to close, it will trigger the close of the panel. Once the close is triggered, the window will be forcibly closed after the end, so please save the data in the close, and if there is an abnormal close, please make a backup of the data so that the data can be restored as much as possible when restarting."))}u.isMDXComponent=!0}}]);
"use strict";(self.webpackChunkcocos_docs_docusaurus=self.webpackChunkcocos_docs_docusaurus||[]).push([[2218],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var s=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,s,o=function(e,t){if(null==e)return{};var n,s,o={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=s.createContext({}),p=function(e){var t=s.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},l=function(e){var t=p(e.components);return s.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},h=s.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),d=p(n),h=o,m=d["".concat(c,".").concat(h)]||d[h]||u[h]||a;return n?s.createElement(m,r(r({ref:t},l),{},{components:n})):s.createElement(m,r({ref:t},l))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=h;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[d]="string"==typeof e?e:o,r[1]=i;for(var p=2;p<a;p++)r[p]=n[p];return s.createElement.apply(null,r)}return s.createElement.apply(null,n)}h.displayName="MDXCreateElement"},25029:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>p});var s=n(87462),o=(n(67294),n(3905));const a={},r="Extending the Database (DB)",i={unversionedId:"editor/extension/contributions-database",id:"editor/extension/contributions-database",title:"Extending the Database (DB)",description:"All asset files in the project are managed through the asset database, where the assets directory in the project stores the assets of the current project, and the editor/assets in the engine repository stores the built-in assets of the engine (e.g., common images, scripts, etc.).",source:"@site/docs/editor/extension/contributions-database.md",sourceDirName:"editor/extension",slug:"/editor/extension/contributions-database",permalink:"/zh/docs/editor/extension/contributions-database",draft:!1,editUrl:"https://github.com/cocos/cocos-docs/docs/editor/extension/contributions-database.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Basic",permalink:"/zh/docs/editor/extension/basic"},next:{title:"Customize the Main Menu",permalink:"/zh/docs/editor/extension/contributions-menu"}},c={},p=[{value:"Registration Database Configuration",id:"registration-database-configuration",level:2},{value:"Writing Script Resources in Extensions",id:"writing-script-resources-in-extensions",level:2},{value:"Other Assets",id:"other-assets",level:2},{value:"Using Assets in Extensions",id:"using-assets-in-extensions",level:2},{value:"Drag-and-drop Assets",id:"drag-and-drop-assets",level:2},{value:"Import Script",id:"import-script",level:2}],l={toc:p},d="wrapper";function u(e){let{components:t,...a}=e;return(0,o.kt)(d,(0,s.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"extending-the-database-db"},"Extending the Database (DB)"),(0,o.kt)("p",null,"All asset files in the project are managed through the asset database, where the ",(0,o.kt)("inlineCode",{parentName:"p"},"assets")," directory in the project stores the assets of the current project, and the ",(0,o.kt)("inlineCode",{parentName:"p"},"editor/assets")," in the engine repository stores the built-in assets of the engine (e.g., common images, scripts, etc.)."),(0,o.kt)("p",null,"When we use the assets in the extension, we need to register the asset folder in the extension to the asset database, and publish the assets with the extension when it is released."),(0,o.kt)("p",null,"Through this article we will learn how to register a asset folder and use the assets in scripts."),(0,o.kt)("h2",{id:"registration-database-configuration"},"Registration Database Configuration"),(0,o.kt)("p",null,"Asset registration needs to be configured in ",(0,o.kt)("inlineCode",{parentName:"p"},"contributions")," using the ",(0,o.kt)("inlineCode",{parentName:"p"},"asset-db")," field, as follows."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json5"},'{\n    "name": "test-package",\n    "contributions": {\n        "asset-db": {\n            "mount": {\n                "path": "./assets",\n                "readonly": true\n            }\n        }\n    }\n}\n')),(0,o.kt)("p",null,"In the above example, we have registered the ",(0,o.kt)("inlineCode",{parentName:"p"},"assets")," folder in the root directory of the extension ",(0,o.kt)("inlineCode",{parentName:"p"},"test-package")," to the asset database."),(0,o.kt)("h2",{id:"writing-script-resources-in-extensions"},"Writing Script Resources in Extensions"),(0,o.kt)("p",null,"Create a script ",(0,o.kt)("inlineCode",{parentName:"p"},"foo.ts")," in the ",(0,o.kt)("inlineCode",{parentName:"p"},"test-package/assets/")," directory, with the following content\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"/// foo.ts\nimport { _decorator, Component, Node } from 'cc';\nconst { ccclass, property } = _decorator;\n \n@ccclass('Foo')\nexport class Foo extends Component {\n    start () {\n        console.log('foo');\n    }\n}\n")),(0,o.kt)("p",null,"In order to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"cc")," definitions, we need to copy the definition files from ",(0,o.kt)("inlineCode",{parentName:"p"},"{project directory}\\temp\\declarations")," to the extension root directory."),(0,o.kt)("p",null,"Since ",(0,o.kt)("inlineCode",{parentName:"p"},"foo.ts")," is only used as a asset and is not part of the extension source code, we need to exclude it by adding ",(0,o.kt)("inlineCode",{parentName:"p"},"exclude")," configuration to ",(0,o.kt)("inlineCode",{parentName:"p"},"tsconfig.json"),", otherwise we will get a compilation error."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json5"},'{\n    "compilerOptions": { \n        ... \n    },\n    "exclude": ["./assets"]\n}\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Note"),": The script assets in the extension can be written and tested in the Cocos Creator project and then copied to the extension's ",(0,o.kt)("inlineCode",{parentName:"p"},"assets")," directory.")),(0,o.kt)("h2",{id:"other-assets"},"Other Assets"),(0,o.kt)("p",null,"Assets such as images, text, fonts, etc. can be placed directly in the ",(0,o.kt)("inlineCode",{parentName:"p"},"assets")," directory."),(0,o.kt)("h2",{id:"using-assets-in-extensions"},"Using Assets in Extensions"),(0,o.kt)("p",null,"Refresh the extension and you will see a new ",(0,o.kt)("inlineCode",{parentName:"p"},"test-package")," assets package in the ",(0,o.kt)("strong",{parentName:"p"},"Assets Manager")," panel of the Cocos Creator editor, as shown below:s"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"extension-database",src:n(42133).Z,width:"940",height:"488"})),(0,o.kt)("h2",{id:"drag-and-drop-assets"},"Drag-and-drop Assets"),(0,o.kt)("p",null,"To reference an asset within a package as a drag-and-drop component, use it in the same way as the assets in ",(0,o.kt)("inlineCode",{parentName:"p"},"assets")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"internal"),"."),(0,o.kt)("h2",{id:"import-script"},"Import Script"),(0,o.kt)("p",null,"You can simply reference a script file from the AssetDatabase as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"/// bar.ts\nimport { Foo } from 'db://test-package/foo';\n")),(0,o.kt)("p",null,"You don't need to pay attention to whether a class comes from an extension package, the TypeScript development environment's auto-completion feature will prompt the ",(0,o.kt)("strong",{parentName:"p"},"import")," directory, no need to worry."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Note"),": The class name in the extension package should be kept globally unique, otherwise it will cause conflicts, try to add a suitable prefix in the actual development (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"test-pacakge")," can be shortened to ",(0,o.kt)("inlineCode",{parentName:"p"},"TP"),", and all classes in the package are unified with the ",(0,o.kt)("inlineCode",{parentName:"p"},"TP")," prefix to become ",(0,o.kt)("inlineCode",{parentName:"p"},"TPFoo"),").")))}u.isMDXComponent=!0},42133:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/extension-database-73da55c2f6a8ef5f27ea15fdb170ec52.png"}}]);
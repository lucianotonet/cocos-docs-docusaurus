"use strict";(self.webpackChunkcocos_docs_docusaurus=self.webpackChunkcocos_docs_docusaurus||[]).push([[5716],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=o.createContext({}),l=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return o.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=l(n),u=r,h=d["".concat(p,".").concat(u)]||d[u]||m[u]||a;return n?o.createElement(h,i(i({ref:t},c),{},{components:n})):o.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=u;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[d]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},72983:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=n(87462),r=(n(67294),n(3905));const a={},i="Custom Inspector Panel",s={unversionedId:"editor/extension/inspector",id:"editor/extension/inspector",title:"Custom Inspector Panel",description:"Developers with custom inspector needs are advised to first refer to the documentation Decorator, and if that document meets the requirements, it is recommended that the methods in that document be used first.",source:"@site/docs/editor/extension/inspector.md",sourceDirName:"editor/extension",slug:"/editor/extension/inspector",permalink:"/zh/docs/editor/extension/inspector",draft:!1,editUrl:"https://github.com/cocos/cocos-docs/docs/editor/extension/inspector.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Multilingual System (i18n)",permalink:"/zh/docs/editor/extension/i18n"},next:{title:"Install and Share",permalink:"/zh/docs/editor/extension/install"}},p={},l=[{value:"Customizing Component Rendering",id:"customizing-component-rendering",level:2},{value:"Automatic Rendering",id:"automatic-rendering",level:3},{value:"Manual Rendering",id:"manual-rendering",level:3},{value:"Customizing Asset rendering",id:"customizing-asset-rendering",level:2}],c={toc:l},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"custom-inspector-panel"},"Custom Inspector Panel"),(0,r.kt)("p",null,"Developers with custom inspector needs are advised to first refer to the documentation ",(0,r.kt)("a",{parentName:"p",href:"../../scripting/decorator.md"},"Decorator"),", and if that document meets the requirements, it is recommended that the methods in that document be used first."),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Inspector")," panel, the module in Cocos Creator that displays the currently selected state, provides some basic extension capabilities."),(0,r.kt)("p",null,"In ",(0,r.kt)("strong",{parentName:"p"},"Inspector")," panel, two levels of data are defined:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"the main type of the selected object"),(0,r.kt)("li",{parentName:"ol"},"the sub-data types contained in the content when rendering the content of the main type")),(0,r.kt)("p",null,"When a ",(0,r.kt)("strong",{parentName:"p"},"node")," or an ",(0,r.kt)("strong",{parentName:"p"},"asset")," is selected in the ",(0,r.kt)("strong",{parentName:"p"},"Hierarchy"),"/",(0,r.kt)("strong",{parentName:"p"},"Assets Panel"),", Cocos Creator broadcasts the message that the object is selected. When the ",(0,r.kt)("strong",{parentName:"p"},"Inspector")," panel receives the message, it checks the type of the selected object, e.g. if the selected object is a node, then the type is ",(0,r.kt)("inlineCode",{parentName:"p"},"node"),"."),(0,r.kt)("p",null,"For both types, two types of renderers are allowed to be registered."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"the main type renderer"),(0,r.kt)("li",{parentName:"ol"},"When the main type renderer receives data to start rendering, it allows subtype renderers to be attached")),(0,r.kt)("p",null,"The selected object in the example is ",(0,r.kt)("inlineCode",{parentName:"p"},"node"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"node")," carries multiple ",(0,r.kt)("inlineCode",{parentName:"p"},"component"),"s, so the main type is ",(0,r.kt)("inlineCode",{parentName:"p"},"node")," and the subtype is ",(0,r.kt)("inlineCode",{parentName:"p"},"component"),"."),(0,r.kt)("p",null,"After the ",(0,r.kt)("strong",{parentName:"p"},"Inspector")," receives the broadcast message for the selected object, it first determines the type, and then the ",(0,r.kt)("strong",{parentName:"p"},"Inspector")," takes the received data (the uuid of the object) and passes it to the ",(0,r.kt)("inlineCode",{parentName:"p"},"node")," renderer, handing over the rendering privileges completely."),(0,r.kt)("p",null,"And in the ",(0,r.kt)("inlineCode",{parentName:"p"},"node")," renderer, the rendering privileges for that region are handed over to the ",(0,r.kt)("inlineCode",{parentName:"p"},"subtype renderer")," when rendering to each ",(0,r.kt)("inlineCode",{parentName:"p"},"component"),", according to its own implementation. For the most part, we don't need to be concerned about this. Let's take a look at a few common ways to customize it."),(0,r.kt)("h2",{id:"customizing-component-rendering"},"Customizing Component Rendering"),(0,r.kt)("p",null,"The default component renderer sometimes doesn't meet our needs, so we need to customize a component's rendering method."),(0,r.kt)("p",null,"First, create a new script component ",(0,r.kt)("inlineCode",{parentName:"p"},"CustomLabelComponent.ts")," in the project and add a string property with the following content:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"\nimport { _decorator, Component, Node } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('CustomLabelComponent')\nexport class CustomLabelComponent extends Component {\n    @property\n    label = '';\n\n    start () {\n\n    }\n}\n\n")),(0,r.kt)("p",null,"Drag the component to the node and you will see an input box on the component."),(0,r.kt)("p",null,"Create a new extension and register the following ",(0,r.kt)("inlineCode",{parentName:"p"},"contributions.inspector")," information in the extension's ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "contributions": {\n        "inspector": {\n            "section": {\n                "node": {\n                    "CustomLabelComponent": "./dist/contributions/inspector/comp-label.js"\n                }\n            }\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"automatic-rendering"},"Automatic Rendering"),(0,r.kt)("p",null,"Write a ",(0,r.kt)("inlineCode",{parentName:"p"},"src/contributions/inspector/comp-label.ts")," file with the following contents:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"'use strict';\n\ntype Selector<$> = { $: Record<keyof $, any | null> }\n\nexport const template = `\n<ui-prop type=\"dump\" class=\"test\"></ui-prop>\n`;\n\nexport const $ = {\n    test: '.test',\n};\n\nexport function update(this: Selector<typeof $> & typeof methods, dump: any) {\n    // Use ui-porp to auto-render, set the type of prop to dump\n    // render pass in a dump data to be able to automatically render the corresponding interface\n    // Auto-rendered interface can automatically commit data after modification\n    this.$.test.render(dump.label.value);\n}\nexport function ready(this: Selector<typeof $> & typeof methods) {}\n")),(0,r.kt)("p",null,"After compiling and refreshing the extension, we can see that the rendering of the ",(0,r.kt)("inlineCode",{parentName:"p"},"CustomLabelComponent")," component has been taken over."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": Each ",(0,r.kt)("inlineCode",{parentName:"p"},"ui-prop")," corresponds to one property, to display multiple properties you need to define multiple ",(0,r.kt)("inlineCode",{parentName:"p"},"ui-props"),".")),(0,r.kt)("h3",{id:"manual-rendering"},"Manual Rendering"),(0,r.kt)("p",null,"In the above auto-rendering example, we used a special ",(0,r.kt)("inlineCode",{parentName:"p"},"ui-prop")," of type ",(0,r.kt)("inlineCode",{parentName:"p"},"dump")," for rendering data submission, which allows us to quickly take over the rendering of the component, but if we face some extreme cases but it is difficult to handle some details, we can switch to manual rendering mode, the code is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"'use strict';\n\ntype Selector<$> = { $: Record<keyof $, any | null> }\n\nexport const template = `\n\x3c!-- Elements to help submit data --\x3e\n<ui-prop type=\"dump\" class=\"test\"></ui-prop>\n\x3c!-- The actual rendered elements --\x3e\n<ui-label class=\"label\"></ui-label>\n<ui-input class=\"test-input\"></ui-input>\n`;\n\nexport const $ = {\n    label:'.label',\n    test: '.test',\n    testInput: '.test-input',\n};\n\ntype PanelThis = Selector<typeof $> & { dump: any };\n\nexport function update(this: PanelThis, dump: any) {\n    // Cache 'dump' data, please hang on 'this', otherwise there may be problems when multiple opening\n    this.dump = dump;\n    // Pass the 'dump' data to the prop element that helped submit the data\n    this.$.test.dump = dump.value.label;\n    // Update the data on the input element responsible for 'input' and display\n    this.$.testInput.value = dump.value.label.value;\n    this.$.label.value = dump.value.label.name;\n}\nexport function ready(this: PanelThis) {\n    // Listen for commit events on the input, update the dump data when the input commits data, and use prop to send change-dump events\n    this.$.testInput.addEventListener('confirm', () => {\n        this.dump.value.label.value = this.$.testInput.value;\n        this.$.test.dispatch('change-dump');\n    });\n}\n")),(0,r.kt)("p",null,"Manual rendering mode still requires data to be submitted via a ",(0,r.kt)("inlineCode",{parentName:"p"},"ui-prop")," element of type ",(0,r.kt)("inlineCode",{parentName:"p"},"dump"),". However, the ",(0,r.kt)("inlineCode",{parentName:"p"},"html")," layout in the ",(0,r.kt)("inlineCode",{parentName:"p"},"template")," is a completely free-handed content that can be displayed in very complex ways depending on the requirements."),(0,r.kt)("h2",{id:"customizing-asset-rendering"},"Customizing Asset rendering"),(0,r.kt)("p",null,"When a file is selected in the ",(0,r.kt)("strong",{parentName:"p"},"Assets")," panel, the ",(0,r.kt)("strong",{parentName:"p"},"Inspector")," panel will display the important properties of the currently selected file, or we can customize the rendering if the default display does not meet the requirements."),(0,r.kt)("p",null,"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"contributions.section.asset")," field to ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," and define a custom rendering script for the corresponding asset type as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "contributions": {\n        "inspector": {\n            "section": {\n                "asset": {\n                    "effect": "./dist/contributions/inspector/asset-effect.js"\n                }\n            }\n        }\n    }\n}\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"effect")," indicates that we want to customize the rendering of the asset inspector panel for the Cocos Effect (*.effect) file type. Common asset file types are as follows."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scene")," - Scene files"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"typescript")," - TypeScript script files"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"prefab")," - prefab files"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"fbx")," - FBX files"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"material")," - material files"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"directory")," - folder"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"image")," - image files")),(0,r.kt)("p",null,"You can get the type definition of the file by looking at the ",(0,r.kt)("inlineCode",{parentName:"p"},"importer")," field in the ",(0,r.kt)("inlineCode",{parentName:"p"},"*.meta")," corresponding to the file."),(0,r.kt)("p",null,"Next, create a new ",(0,r.kt)("inlineCode",{parentName:"p"},"src/contributions/inspector/asset-effect.ts")," script file in the extension directory and write the following code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"'use strict';\n\ninterface Asset {\n    displayName: string;\n    file: string;\n    imported: boolean;\n    importer: string;\n    invalid: boolean;\n    isDirectory: boolean;\n    library: {\n        [extname: string]: string;\n    };\n    name: string;\n    url: string;\n    uuid: string;\n    visible: boolean;\n    subAssets: {\n        [id: string]: Asset;\n    };\n}\n\ninterface Meta {\n    files: string[];\n    imported: boolean;\n    importer: string;\n    subMetas: {\n        [id: string]: Meta;\n    };\n    userData: {\n        [key: string]: any;\n    };\n    uuid: string;\n    ver: string;\n}\n\ntype Selector<$> = { $: Record<keyof $, any | null> } & { dispatch(str: string): void, assetList: Asset[], metaList: Meta[] };\n\nexport const $ = {\n    'test': '.test',\n};\n\nexport const template = `\n<ui-prop>\n    <ui-label slot=\"label\">Test</ui-label>\n    <ui-checkbox slot=\"content\" class=\"test\"></ui-checkbox>\n</ui-prop>\n`;\n\ntype PanelThis = Selector<typeof $>;\n\nexport function update(this: PanelThis, assetList: Asset[], metaList: Meta[]) {\n    this.assetList = assetList;\n    this.metaList = metaList;\n    this.$.test.value = metaList[0].userData.test || false;\n};\n\nexport function ready(this: PanelThis) {\n    this.$.test.addEventListener('confirm', () => {\n        this.metaList.forEach((meta: any) => {\n            // Modify the data in the corresponding meta\n            meta.userData.test = !!this.$.test.value;\n        });\n        // The Assets panel is modifying the meta file of the asset, not the dump data, so the event sent is not the same as the component property modification\n        this.dispatch('change');\n    });\n};\n\nexport function close(his: PanelThis, ) {\n    // TODO something\n};\n")),(0,r.kt)("p",null,"After compiling and refreshing the extension, go back to the Cocos Creator editor interface, select one of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Cocos Effect")," files, and you can find an additional ",(0,r.kt)("strong",{parentName:"p"},"Test checkbox")," at the bottom of the ",(0,r.kt)("strong",{parentName:"p"},"Inspector")," panel."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": Multiple extensions register data side by side. If a ",(0,r.kt)("strong",{parentName:"p"},"Component"),"/",(0,r.kt)("strong",{parentName:"p"},"Asset")," already has a custom renderer, any custom renderers registered again will be appended to it. If a ",(0,r.kt)("strong",{parentName:"p"},"Component"),"/",(0,r.kt)("strong",{parentName:"p"},"Asset")," does not have a custom renderer built-in and uses the default renderer, then when the extension registers a custom renderer, it takes over the rendered content completely.")))}m.isMDXComponent=!0}}]);
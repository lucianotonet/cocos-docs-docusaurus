"use strict";(self.webpackChunkcocos_docs_docusaurus=self.webpackChunkcocos_docs_docusaurus||[]).push([[4644],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),m=i,h=d["".concat(c,".").concat(m)]||d[m]||u[m]||a;return n?r.createElement(h,o(o({ref:t},p),{},{components:n})):r.createElement(h,o({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[d]="string"==typeof e?e:i,o[1]=s;for(var l=2;l<a;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},47066:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var r=n(87462),i=(n(67294),n(3905));const a={},o="Calling the Engine API and Project Script",s={unversionedId:"editor/extension/scene-script",id:"editor/extension/scene-script",title:"Calling the Engine API and Project Script",description:"In the extension you can define a special scene script file, which will be in the same runtime as the scripts in the assets\\ directory of the project, with the same runtime environment.",source:"@site/docs/editor/extension/scene-script.md",sourceDirName:"editor/extension",slug:"/editor/extension/scene-script",permalink:"/zh/docs/editor/extension/scene-script",draft:!1,editUrl:"https://github.com/cocos/cocos-docs/docs/editor/extension/scene-script.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Configuration System",permalink:"/zh/docs/editor/extension/profile"},next:{title:"Submitting Resources to Cocos Store",permalink:"/zh/docs/editor/extension/store/upload-store"}},c={},l=[{value:"Register Scene Script",id:"register-scene-script",level:2},{value:"Scene Script Template",id:"scene-script-template",level:2},{value:"Calling the Engine API",id:"calling-the-engine-api",level:2}],p={toc:l},d="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(d,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"calling-the-engine-api-and-project-script"},"Calling the Engine API and Project Script"),(0,i.kt)("p",null,"In the extension you can define a special ",(0,i.kt)("strong",{parentName:"p"},"scene script")," file, which will be in the same runtime as the scripts in the ",(0,i.kt)("inlineCode",{parentName:"p"},"assets\\")," directory of the project, with the same runtime environment."),(0,i.kt)("p",null,"In the ",(0,i.kt)("strong",{parentName:"p"},"Scene Script")," you can call the engine ",(0,i.kt)("inlineCode",{parentName:"p"},"API")," and other project scripts, and with this feature we can"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Query and traverse the nodes in the scene to get or modify node data"),(0,i.kt)("li",{parentName:"ul"},"Call functions related to the engine components on the node to finish the job")),(0,i.kt)("h2",{id:"register-scene-script"},"Register Scene Script"),(0,i.kt)("p",null,"First, add a ",(0,i.kt)("inlineCode",{parentName:"p"},"scene")," field to the ",(0,i.kt)("inlineCode",{parentName:"p"},"contributions")," property of ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),", the value of which is the path to a script file, relative to the extension package directory. Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "contributions": {\n        "scene": {\n            "script": "./dist/scene.js"\n        }\n    }\n}\n')),(0,i.kt)("h2",{id:"scene-script-template"},"Scene Script Template"),(0,i.kt)("p",null,"Create a new ",(0,i.kt)("inlineCode",{parentName:"p"},"scene.ts")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"src")," directory and write the following code."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export function load() {};\nexport function unload() {};\nexport const methods = { };\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"load")," - the function that fires when the module is loaded"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"unload")," - the function that fires when the module is unloaded"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"methods")," - methods defined inside the module that can be used to respond to external messages"),(0,i.kt)("h2",{id:"calling-the-engine-api"},"Calling the Engine API"),(0,i.kt)("p",null,"Next, we will demonstrate how the scene script calls the engine API by rotating the main camera."),(0,i.kt)("p",null,"In order to call the engine API, we need to add the search path of the engine script at the beginning of ",(0,i.kt)("inlineCode",{parentName:"p"},"scene.ts")," and write the corresponding code, which ends up looking like this"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { join } from 'path';\nmodule.paths.push(join(Editor.App.path, 'node_modules'));\n\nexport function load() {};\n\nexport function unload() {};\n\nexport const methods = {\n    rotateCamera() {\n        const { director } = require('cc');\n        let mainCamera = director.getScene().getChildByName(\"Main Camera\");\n        if(mainCamera){\n            let euler = mainCamera.eulerAngles;\n            euler.y += 10;\n            mainCamera.setRotationFromEuler(euler);\n            return true;\n        }\n        return false;\n    },\n};\n")),(0,i.kt)("p",null,"In the above code, we have defined a ",(0,i.kt)("inlineCode",{parentName:"p"},"rotateCamera")," method that rotates the main camera ",(0,i.kt)("inlineCode",{parentName:"p"},"10")," degrees around the ",(0,i.kt)("inlineCode",{parentName:"p"},"Y")," axis every time it is executed."),(0,i.kt)("p",null,"In other extension scripts, we can call the ",(0,i.kt)("inlineCode",{parentName:"p"},"rotateCamera")," function with the following code."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"const options: ExecuteSceneScriptMethodOptions = {\n    name: packageJSON.name,\n    method: 'rotateCamera',\n    args: []\n};\n\n// result: {}\nconst result = await Editor.Message.request('scene', 'execute-scene-script', options);\n")),(0,i.kt)("p",null,"The properties of ",(0,i.kt)("inlineCode",{parentName:"p"},"ExecuteSceneScriptMethodOptions")," are defined as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"name - the package name of the extension where ",(0,i.kt)("inlineCode",{parentName:"li"},"scene.ts")," is located, you can use ",(0,i.kt)("inlineCode",{parentName:"li"},"packageJSON.name")," if it is in this extension"),(0,i.kt)("li",{parentName:"ul"},"method: the method defined in ",(0,i.kt)("inlineCode",{parentName:"li"},"scene.ts")),(0,i.kt)("li",{parentName:"ul"},"args: arguments, optional")),(0,i.kt)("p",null,"As the communication between extensions is based on Electron's underlying cross-process IPC mechanism, the transferred data will be serialized as JSON. so the transferred data must not contain native objects, otherwise it may lead to process crashes or memory spikes. It is recommended to transfer only pure ",(0,i.kt)("inlineCode",{parentName:"p"},"JSON")," objects, such as the ",(0,i.kt)("inlineCode",{parentName:"p"},"options.args")," parameter in the above code and the return value of the scenario script method."))}u.isMDXComponent=!0}}]);
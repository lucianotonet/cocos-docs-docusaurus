"use strict";(self.webpackChunkcocos_docs_docusaurus=self.webpackChunkcocos_docs_docusaurus||[]).push([[9668],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||s;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,r=new Array(s);r[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:o,r[1]=i;for(var p=2;p<s;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},55053:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const s={},r="Panel and Extension Communication",i={unversionedId:"editor/extension/panel-messages",id:"editor/extension/panel-messages",title:"Panel and Extension Communication",description:"NOTE: After v3.5, we updated the plugin documentation, so this documentation is deprecated, please move to Message System or Customized Messages for more information. If you see this document online, please post an issue on github and let the official staff know how to handle it.",source:"@site/docs/editor/extension/panel-messages.md",sourceDirName:"editor/extension",slug:"/editor/extension/panel-messages",permalink:"/docs/editor/extension/panel-messages",draft:!1,editUrl:"https://github.com/cocos/cocos-docs/docs/editor/extension/panel-messages.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Creating a Custom Panel",permalink:"/docs/editor/extension/panel-boot"},next:{title:"Extension Panel",permalink:"/docs/editor/extension/panel"}},l={},p=[{value:"Define the method of extending the top and panel",id:"define-the-method-of-extending-the-top-and-panel",level:2},{value:"Send a message",id:"send-a-message",level:2}],c={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"panel-and-extension-communication"},"Panel and Extension Communication"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"NOTE"),": After v3.5, we updated the plugin documentation, so this documentation is deprecated, please move to ",(0,o.kt)("a",{parentName:"p",href:"/docs/editor/extension/messages"},"Message System")," or ",(0,o.kt)("a",{parentName:"p",href:"/docs/editor/extension/contributions-messages"},"Customized Messages")," for more information. If you see this document online, please post an issue on ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cocos/cocos-docs/issues/new"},"github")," and let the official staff know how to handle it.")),(0,o.kt)("p",null,"Some useful tools or simple functions can be written directly on the panel, but the panel is not a reliable data storage location. The window may be closed at any time, and the panel will also be closed."),(0,o.kt)("p",null,"The most common example is that a panel is dragged and docked to the main window. At this time, the panel will be closed first and then reopened in the main window. If the data in the memory used on the panel is not stored and backed up, it will be lost with restart."),(0,o.kt)("p",null,"At this time, a certain degree of data interaction is required with the extended main body."),(0,o.kt)("p",null,"Before reading this chapter, please review the ",(0,o.kt)("a",{parentName:"p",href:"/docs/editor/extension/messages"},"Message System")," documentation."),(0,o.kt)("h2",{id:"define-the-method-of-extending-the-top-and-panel"},"Define the method of extending the top and panel"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"First"),", define a ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "hello-world",\n    "main": "./browser.js",\n    "panels": {\n        "default": {\n            "title": "hw",\n            "main": "./panel.js"\n        }\n    },\n    "contributions": {\n        "messages": {\n            "upload": {\n                "methods": ["saveData"]\n            },\n            "query": {\n                "methods": ["queryData"]\n            }\n        }\n    }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Second"),", define the extended main file ",(0,o.kt)("inlineCode",{parentName:"p"},"browser.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"exports.methods = {\n    saveData(path, data) {\n        // Cache it after receiving the data\n        this.cache[path] = data;\n    },\n    queryData(path) {\n        const result = this.cache[path];\n        delete this.cache[path];\n        return result;\n    },\n};\n\nexports.load = function() {};\nexports.unload = function() {};\n")),(0,o.kt)("p",null,"Typescript"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"interface PackagelItem {\n    cache: {\n        [path: string]: any;\n    }\n}\nexport const methods = {\n    saveData(this: PackagelItem, path: string, data: any) {\n        // \u6536\u5230\u6570\u636e\u540e\u7f13\u5b58\u8d77\u6765\n        this.cache[path] = data;\n    },\n    queryData(this: PackagelItem, path: string) {\n        const result = this.cache[path];\n        delete this.cache[path];\n        return result;\n    },\n};\n\nexport function load() {};\nexport function unloal() {};\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Last"),", define the main file of the panel:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const packageJSON = require('./package.json');\nexports.ready = async () => {\n    const tab = await Editor.Message.request(packageJSON.name, 'query', 'tab');\n    const subTab = await Editor.Message.request(packageJSON.name, 'query', 'subTab');\n\n    // Print the queried data\n    console.log(tab, subTab):\n    // TODO uses these two data to initialize\n};\nexports.close() {\n    // Upload the data to the extension process after receiving the data\n    Editor.Message.send(packageJSON.name, 'upload', 'tab', 1);\n    Editor.Message.send(packageJSON.name, 'upload', 'subTab', 0);\n};\n")),(0,o.kt)("p",null,"Typescript"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { name } from './package.json';\nexports.ready = async () => {  \n    const tab = await Editor.Message.request(name, 'query', 'tab');\n    const subTab = await Editor.Message.request(name, 'query', 'subTab');\n    // \u6253\u5370\u67e5\u8be2\u5230\u7684\u6570\u636e\n    console.log(tab, subTab):\n    // TODO \u4f7f\u7528\u8fd9\u4e24\u4e2a\u6570\u636e\u521d\u59cb\u5316\n};\nexports.close() {\n    // \u6536\u5230\u6570\u636e\u540e\u4e0a\u4f20\u5230\u6269\u5c55\u8fdb\u7a0b\n    Editor.Message.send(name, 'upload', 'tab', 1);\n    Editor.Message.send(name, 'upload', 'subTab', 0);\n};\n")),(0,o.kt)("h2",{id:"send-a-message"},"Send a message"),(0,o.kt)("p",null,"After defining the extension and the panels in the extension, we can try to trigger these messages."),(0,o.kt)("p",null,"Press ",(0,o.kt)("strong",{parentName:"p"},"ctrl(cmd) + shift + i")," to open the console. Open the panel in the console:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// Default can be omitted, if the panel name is not default, you need to fill in'hello-world.xxx'\nEditor.Panel.open('hello-world');\n")),(0,o.kt)("p",null,"After opening the panel, the console will print out a sentence:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"undefined, undefined\n")),(0,o.kt)("p",null,"This is because the data has not yet been submitted. Now, close this panel and open it again. At this time, the console prints out the data:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"1, 0\n")),(0,o.kt)("p",null,"Because when the panel is closed, two messages are sent:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"Editor.Message.send(packageJSON.name, 'upload', 'tab', 1);\nEditor.Message.send(packageJSON.name, 'upload', 'subTab', 0);\n")),(0,o.kt)("p",null,"Through these two messages, the Message system first saves the data to the extension process according to the upload definition in messages ",(0,o.kt)("inlineCode",{parentName:"p"},'"methods": ["saveData"]'),"."),(0,o.kt)("p",null,"When opening the panel again, use the following code to query for the data you just saved, initialize the interface, and print to the console."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const tab = await Editor.Message.send(packageJSON.name, 'query', 'tab');\nconst subTab = await Editor.Message.send(packageJSON.name, 'query', 'subTab');\n")),(0,o.kt)("p",null,"At this point, we have completed an interaction between the panel and the extension process."))}u.isMDXComponent=!0}}]);